<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrailPro - Entra√Ænement Running</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Configuration Firebase - √Ä REMPLACER par vos propres credentials
        const firebaseConfig = {
¬†       apiKey: "AIzaSyA5vqQR4UevVwgmGtoGGc6gpojTzE10qbo",
¬†       authDomain: "aliorunning.firebaseapp.com",
¬†       projectId: "aliorunning",
¬†       storageBucket: "aliorunning.firebasestorage.app",
¬†       messagingSenderId: "358450238834",
¬†       appId: "1:358450238834:web:938b2e99ca91a7202c79eb",
¬†       measurementId: "G-J65C87TZ3S"
        };
        
        // Initialiser Firebase
        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                window.firebaseAuth = firebase.auth();
                window.firebaseDb = firebase.firestore();
                console.log('‚úÖ Firebase initialis√© avec succ√®s');
            } else {
                console.error('‚ùå Firebase n\'est pas charg√©. V√©rifiez votre connexion internet.');
            }
        } catch (error) {
            console.error('‚ùå Erreur lors de l\'initialisation de Firebase:', error);
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --orange-primary: #FC4C02;
            --orange-hover: #E64402;
            --orange-light: #FFF4F0;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-300: #d4d4d4;
            --gray-400: #a3a3a3;
            --gray-500: #737373;
            --gray-600: #525252;
            --gray-700: #404040;
            --gray-800: #262626;
            --gray-900: #171717;
            --border: var(--gray-200);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .app-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--orange-primary);
            letter-spacing: -0.5px;
        }
        
        .header-subtitle {
            color: var(--gray-600);
            font-size: 13px;
            font-weight: 500;
        }
        
        .header-nav {
            display: flex;
            gap: 4px;
        }
        
        .nav-btn {
            padding: 8px 14px;
            border: none;
            background: transparent;
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .nav-btn:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }
        
        .nav-btn.active {
            background: var(--orange-light);
            color: var(--orange-primary);
        }
        
        .content {
            padding: 24px;
        }
        
        .card {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .card-header {
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }
        
        .card-description {
            font-size: 14px;
            color: var(--gray-600);
        }
        
        .goal-banner {
            background: linear-gradient(135deg, var(--orange-primary) 0%, #D43F00 100%);
            color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .goal-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .goal-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            opacity: 0.95;
            flex-wrap: wrap;
        }
        
        .goal-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .workout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .workout-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            position: relative;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .workout-card:hover:not(.completed):not(.locked) {
            border-color: var(--orange-primary);
            box-shadow: 0 4px 12px rgba(252, 76, 2, 0.1);
        }
        
        .workout-card.completed {
            background: var(--gray-50);
            opacity: 0.7;
        }
        
        .workout-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .workout-badge {
            display: inline-block;
            width: fit-content;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        
        .workout-badge.endurance { background: #E0F2FE; color: #0369A1; }
        .workout-badge.interval-short { background: #FEF3C7; color: #A16207; }
        .workout-badge.interval-medium { background: #FEF3C7; color: #A16207; }
        .workout-badge.tempo { background: #FFEDD5; color: #C2410C; }
        .workout-badge.hills { background: #F3E8FF; color: #7E22CE; }
        .workout-badge.long { background: #DCFCE7; color: #15803D; }
        .workout-badge.recovery { background: #F0FDFA; color: #0F766E; }
        .workout-badge.goal { background: var(--orange-light); color: var(--orange-primary); }
        
        .workout-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }
        
        .workout-desc {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .workout-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .workout-stat-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: var(--gray-50);
            border-radius: 8px;
        }
        
        .workout-stat-label {
            font-size: 11px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .workout-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .workout-stat-unit {
            font-size: 12px;
            color: var(--gray-600);
            font-weight: 500;
            margin-left: 2px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--orange-primary);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--orange-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(252, 76, 2, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--gray-50);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--gray-700);
        }
        
        .btn-ghost:hover {
            background: var(--gray-100);
        }
        
        .btn-success {
            background: #10B981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.2s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }
        
        .modal-subtitle {
            font-size: 14px;
            color: var(--gray-600);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--orange-primary);
            box-shadow: 0 0 0 3px rgba(252, 76, 2, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 8px;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 12px 8px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .difficulty-btn:hover {
            border-color: var(--orange-primary);
        }
        
        .difficulty-btn.selected {
            border-color: var(--orange-primary);
            background: var(--orange-light);
        }
        
        .difficulty-emoji {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }
        
        .difficulty-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .radio-option:hover {
            border-color: var(--orange-primary);
            background: var(--gray-50);
        }
        
        .radio-option.selected {
            border-color: var(--orange-primary);
            background: var(--orange-light);
        }
        
        .radio-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--orange-primary);
        }
        
        .radio-option-content {
            flex: 1;
        }
        
        .radio-option-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }
        
        .radio-option-desc {
            font-size: 13px;
            color: var(--gray-600);
            line-height: 1.4;
        }
        
        .progress-section {
            margin-bottom: 24px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .progress-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--orange-primary);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--orange-primary);
            transition: width 0.5s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
        }
        
        .stat-title {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .stat-unit {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-top: 16px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            background: var(--gray-100);
            color: var(--gray-500);
        }
        
        .calendar-day.has-workout {
            background: var(--orange-primary);
            color: white;
        }
        
        .calendar-day.today {
            border: 2px solid var(--orange-primary);
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .alert-info {
            background: #EFF6FF;
            color: #1E40AF;
            border: 1px solid #BFDBFE;
        }
        
        .alert-success {
            background: #F0FDF4;
            color: #15803D;
            border: 1px solid #BBF7D0;
        }
        
        .alert-warning {
            background: #FFFBEB;
            color: #B45309;
            border: 1px solid #FDE68A;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }
        
        .empty-description {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 24px;
        }
        
        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .week-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .week-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .week-badge.current {
            background: var(--orange-light);
            color: var(--orange-primary);
        }
        
        .week-badge.future {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        
        .history-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 12px;
        }
        
        .history-date {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }
        
        .history-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }
        
        .history-note {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 12px;
            font-style: italic;
        }
        
        .history-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .history-stat {
            text-align: center;
            padding: 10px;
            background: var(--gray-50);
            border-radius: 8px;
        }
        
        .history-stat-label {
            font-size: 11px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .history-stat-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
            margin-top: 4px;
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
        }
        
        .difficulty-1 { background: #FEE2E2; color: #991B1B; }
        .difficulty-2 { background: #FED7AA; color: #9A3412; }
        .difficulty-3 { background: #DBEAFE; color: #1E40AF; }
        .difficulty-4 { background: #D1FAE5; color: #065F46; }
        .difficulty-5 { background: #F3E8FF; color: #6B21A8; }
        
        .week-summary {
            display: flex;
            gap: 12px;
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 16px;
        }
        
        .completed-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 14px;
        }
        
        .completed-check.done {
            background: #10B981;
            color: white;
        }
        
        .completed-check.pending {
            background: var(--gray-200);
            color: var(--gray-500);
        }
        
        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-600);
        }
        
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        
        .auth-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 32px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
            text-align: center;
        }
        
        .auth-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            text-align: center;
            margin-bottom: 24px;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: var(--gray-600);
        }
        
        .auth-toggle button {
            background: none;
            border: none;
            color: var(--orange-primary);
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
        }
        
        .auth-toggle button:hover {
            text-decoration: underline;
        }
        
        .error-message {
            background: #FEE2E2;
            color: #991B1B;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-email {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .mobile-menu {
            position: relative;
            display: none;
        }
        
        .burger-btn {
            background: transparent;
            border: none;
            color: var(--gray-700);
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .burger-btn:hover {
            background: var(--gray-100);
        }
        
        .mobile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1000;
            overflow: hidden;
        }
        
        .mobile-dropdown button {
            display: block;
            width: 100%;
            padding: 12px 16px;
            text-align: left;
            border: none;
            background: transparent;
            color: var(--gray-700);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .mobile-dropdown button:hover {
            background: var(--gray-50);
        }
        
        .mobile-dropdown button.active {
            background: var(--orange-light);
            color: var(--orange-primary);
        }
        
        .welcome-message {
            background: transparent;
            color: var(--gray-900);
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 24px;
            font-size: 16px;
            font-weight: 400;
        }
        
        .welcome-message strong {
            font-weight: 700;
        }
        
        .workout-details-btn {
            margin-top: 12px;
        }
        
        .workout-buttons-group {
            display: flex;
            gap: 12px;
            margin-top: auto;
            padding-top: 12px;
        }
        
        .workout-buttons-group .btn {
            flex: 1;
        }
        
        .workout-details-modal {
            max-width: 600px;
        }
        
        .workout-details-section {
            margin-bottom: 20px;
        }
        
        .workout-details-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }
        
        .workout-details-section p {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .treadmill-info {
            background: var(--orange-light);
            border: 1px solid var(--orange-primary);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .treadmill-info strong {
            color: var(--orange-primary);
        }
        
        .tabs {
            display: flex;
            gap: 4px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .tab-btn:hover {
            color: var(--gray-900);
            background: var(--gray-50);
        }
        
        .tab-btn.active {
            color: var(--orange-primary);
            border-bottom-color: var(--orange-primary);
        }
        
        /* Toast System (Sonner inspired) */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none;
        }
        
        .toast {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            pointer-events: auto;
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.success {
            border-left: 3px solid #10B981;
        }
        
        .toast.error {
            border-left: 3px solid #EF4444;
        }
        
        .toast.info {
            border-left: 3px solid #3B82F6;
        }
        
        .toast.warning {
            border-left: 3px solid #F59E0B;
        }
        
        .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
            font-size: 14px;
            color: var(--gray-900);
            line-height: 1.4;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .toast-close:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-600);
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .content {
                padding: 16px;
            }
            
            .workout-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header-nav {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                font-size: 13px;
                padding: 6px 12px;
            }
            
            /* Cacher la navigation desktop sur mobile */
            .header-nav .nav-btn:not(.burger-btn) {
                display: none;
            }
            
            /* Afficher le menu burger sur mobile */
            .mobile-menu {
                display: block;
            }
            
            .auth-card {
                padding: 24px;
            }
        }
        
        @media (min-width: 769px) {
            /* Cacher le menu burger sur desktop */
            .mobile-menu {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Hook useAuth pour g√©rer la session utilisateur
        function useAuth() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                if (!window.firebaseAuth) {
                    setLoading(false);
                    return;
                }
                
                const unsubscribe = window.firebaseAuth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                });
                
                return () => unsubscribe();
            }, []);
            
            const signIn = async (email, password) => {
                return window.firebaseAuth.signInWithEmailAndPassword(email, password);
            };
            
            const signUp = async (email, password) => {
                return window.firebaseAuth.createUserWithEmailAndPassword(email, password);
            };
            
            const signOut = async () => {
                return window.firebaseAuth.signOut();
            };
            
            const updatePassword = async (newPassword) => {
                return window.firebaseAuth.currentUser.updatePassword(newPassword);
            };
            
            const reauthenticate = async (password) => {
                const credential = firebase.auth.EmailAuthProvider.credential(
                    window.firebaseAuth.currentUser.email,
                    password
                );
                return window.firebaseAuth.currentUser.reauthenticateWithCredential(credential);
            };
            
            return { user, loading, signIn, signUp, signOut, updatePassword, reauthenticate };
        }
        
        // Fonctions Firestore pour remplacer localStorage
        async function getProfile(userId) {
            if (!window.firebaseDb || !userId) return null;
            const profileRef = window.firebaseDb.collection('profiles').doc(userId);
            const profileSnap = await profileRef.get();
            if (profileSnap.exists) {
                return profileSnap.data();
            }
            return null;
        }
        
        async function saveProfile(userId, profile) {
            if (!window.firebaseDb || !userId) return;
            const profileRef = window.firebaseDb.collection('profiles').doc(userId);
            await profileRef.set({ ...profile, updatedAt: new Date().toISOString() }, { merge: true });
        }
        
        async function getGoal(userId) {
            if (!window.firebaseDb || !userId) return null;
            const goalsRef = window.firebaseDb.collection('goals');
            const querySnapshot = await goalsRef
                .where('userId', '==', userId)
                .orderBy('createdAt', 'desc')
                .limit(1)
                .get();
            if (!querySnapshot.empty) {
                const doc = querySnapshot.docs[0];
                return { id: doc.id, ...doc.data() };
            }
            return null;
        }
        
        async function saveGoal(userId, goal) {
            if (!window.firebaseDb || !userId) return;
            if (goal.id) {
                const goalRef = window.firebaseDb.collection('goals').doc(goal.id);
                await goalRef.set({ ...goal, userId, updatedAt: new Date().toISOString() }, { merge: true });
            } else {
                const goalsRef = window.firebaseDb.collection('goals');
                await goalsRef.add({ ...goal, userId, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() });
            }
        }
        
        async function deleteGoal(userId, goalId) {
            if (!window.firebaseDb || !userId || !goalId) return;
            const goalRef = window.firebaseDb.collection('goals').doc(goalId);
            await goalRef.delete();
        }
        
        async function getWeeklyPlans(userId) {
            if (!window.firebaseDb || !userId) return [];
            const plansRef = window.firebaseDb.collection('weeklyPlans');
            const querySnapshot = await plansRef
                .where('userId', '==', userId)
                .orderBy('createdAt', 'desc')
                .limit(1)
                .get();
            if (!querySnapshot.empty) {
                return querySnapshot.docs[0].data().plans || [];
            }
            return [];
        }
        
        async function saveWeeklyPlans(userId, plans) {
            if (!window.firebaseDb || !userId) return;
            const plansRef = window.firebaseDb.collection('weeklyPlans');
            const querySnapshot = await plansRef
                .where('userId', '==', userId)
                .orderBy('createdAt', 'desc')
                .limit(1)
                .get();
            if (!querySnapshot.empty) {
                const planRef = window.firebaseDb.collection('weeklyPlans').doc(querySnapshot.docs[0].id);
                await planRef.set({ plans, userId, updatedAt: new Date().toISOString() }, { merge: true });
            } else {
                await plansRef.add({ plans, userId, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() });
            }
        }
        
        async function getWorkouts(userId) {
            if (!window.firebaseDb || !userId) return [];
            const workoutsRef = window.firebaseDb.collection('workouts');
            const querySnapshot = await workoutsRef
                .where('userId', '==', userId)
                .orderBy('date', 'desc')
                .get();
            return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }
        
        async function saveWorkout(userId, workout) {
            if (!window.firebaseDb || !userId) return;
            const workoutsRef = window.firebaseDb.collection('workouts');
            await workoutsRef.add({ ...workout, userId, createdAt: new Date().toISOString() });
        }
        
        // Syst√®me de toast inspir√© de Sonner
        function toast(message, options = {}) {
            const { type = 'default', duration = 4000 } = options;
            const toastId = Date.now();
            
            const toastContainer = document.getElementById('toast-container') || (() => {
                const container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container';
                document.body.appendChild(container);
                return container;
            })();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = `toast-${toastId}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è',
                default: 'üí¨'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.default}</span>
                <span class="toast-content">${message}</span>
                <button class="toast-close" onclick="this.closest('.toast').remove()">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    const toastEl = document.getElementById(`toast-${toastId}`);
                    if (toastEl) {
                        toastEl.style.animation = 'slideInRight 0.3s ease-out reverse';
                        setTimeout(() => toastEl.remove(), 300);
                    }
                }, duration);
            }
            
            return toastId;
        }
        
        // Helpers pour les diff√©rents types de toast
        window.toast = toast;
        window.toast.success = (message, options) => toast(message, { ...options, type: 'success' });
        window.toast.error = (message, options) => toast(message, { ...options, type: 'error' });
        window.toast.info = (message, options) => toast(message, { ...options, type: 'info' });
        window.toast.warning = (message, options) => toast(message, { ...options, type: 'warning' });

        function TrailTrainingApp() {
            const { user, loading, signIn, signUp, signOut, updatePassword, reauthenticate } = useAuth();
            const [isSignUp, setIsSignUp] = useState(false);
            const [authEmail, setAuthEmail] = useState('');
            const [authPassword, setAuthPassword] = useState('');
            const [authError, setAuthError] = useState('');
            const [authLoading, setAuthLoading] = useState(false);
            
            const [activeView, setActiveView] = useState('home');
            const [goal, setGoal] = useState(null);
            const [weeklyPlan, setWeeklyPlan] = useState([]);
            const [history, setHistory] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [currentWorkout, setCurrentWorkout] = useState(null);
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [showWorkoutDetails, setShowWorkoutDetails] = useState(null);
            
            const [profile, setProfile] = useState({
                level: 'intermediate', // beginner, intermediate, advanced, expert
                best5k: '',
                best10k: '',
                vma: '',
                challengeMode: false,
                weeklyVolume: '30-50', // 0-20, 15-35, 30-50, 40-60, 60+
                indoorTraining: false, // Si l'utilisateur court en salle
                maxHeartRate: 190 // FC max pour calculs TRIMP
            });


            const [goalForm, setGoalForm] = useState({
                name: '',
                date: '',
                distance: '',
                elevation: '',
                notes: '',
                trainingType: 'mixed',
                sessionsPerWeek: 3,
                maxDuration: 60
            });
            
            const [workoutForm, setWorkoutForm] = useState({
                distance: '',
                time: '',
                elevation: '',
                heartRate: '',
                difficulty: 3,
                notes: ''
            });
            
            // √âtat pour le changement de mot de passe
            const [showPasswordChange, setShowPasswordChange] = useState(false);
            const [passwordForm, setPasswordForm] = useState({
                currentPassword: '',
                newPassword: '',
                confirmPassword: ''
            });
            const [passwordError, setPasswordError] = useState('');
            
            // √âtat pour les tabs dans la vue profil
            const [activeTab, setActiveTab] = useState('profile');

            // Charger les donn√©es depuis Firestore
            useEffect(() => {
                if (!user || loading) return;
                
                const loadData = async () => {
                    try {
                        const [savedProfile, savedGoal, savedPlans, savedHistory] = await Promise.all([
                            getProfile(user.uid),
                            getGoal(user.uid),
                            getWeeklyPlans(user.uid),
                            getWorkouts(user.uid)
                        ]);
                        
                        if (savedProfile) setProfile(savedProfile);
                        if (savedGoal) {
                            setGoal(savedGoal);
                            setGoalForm(savedGoal);
                        }
                        if (savedPlans && savedPlans.length > 0) setWeeklyPlan(savedPlans);
                        if (savedHistory && savedHistory.length > 0) setHistory(savedHistory);
                    } catch (error) {
                        console.error('Erreur lors du chargement des donn√©es:', error);
                    }
                };
                
                loadData();
            }, [user, loading]);

            // Sauvegarder le profil dans Firestore et r√©g√©n√©rer le planning si un objectif existe
            useEffect(() => {
                if (!user || loading) return;
                const timeoutId = setTimeout(() => {
                    saveProfile(user.uid, profile);
                    // R√©g√©n√©rer le planning si un objectif existe (sans toast, c'est automatique)
                    if (goal) {
                        generateWeeklyPlan();
                    }
                }, 500);
                return () => clearTimeout(timeoutId);
            }, [profile, user, loading]);

            // Sauvegarder l'objectif dans Firestore et r√©g√©n√©rer le planning (sans toast, c'est automatique)
            useEffect(() => {
                if (!user || loading || !goal) return;
                const timeoutId = setTimeout(() => {
                    saveGoal(user.uid, goal).then(() => {
                        generateWeeklyPlan();
                    });
                }, 500);
                return () => clearTimeout(timeoutId);
            }, [goal, user, loading]);

            // Sauvegarder le planning dans Firestore
            useEffect(() => {
                if (!user || loading || weeklyPlan.length === 0) return;
                const timeoutId = setTimeout(() => {
                    saveWeeklyPlans(user.uid, weeklyPlan);
                }, 500);
                return () => clearTimeout(timeoutId);
            }, [weeklyPlan, user, loading]);

            // Gestion de l'authentification
            const handleAuth = async (e) => {
                e.preventDefault();
                setAuthError('');
                setAuthLoading(true);
                
                try {
                    if (isSignUp) {
                        await signUp(authEmail, authPassword);
                        toast.success('Compte cr√©√© avec succ√®s ! Bienvenue sur TrailPro.');
                    } else {
                        await signIn(authEmail, authPassword);
                        toast.success('Connexion r√©ussie !');
                    }
                    setAuthEmail('');
                    setAuthPassword('');
                } catch (error) {
                    let errorMessage = 'Une erreur est survenue';
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'Cet email est d√©j√† utilis√©. Connectez-vous ou utilisez un autre email.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Email invalide';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Le mot de passe doit contenir au moins 6 caract√®res';
                    } else if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Aucun compte trouv√© avec cet email';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Mot de passe incorrect';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Trop de tentatives. Veuillez r√©essayer plus tard.';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }
                    setAuthError(errorMessage);
                } finally {
                    setAuthLoading(false);
                }
            };

            // Protection des routes - rediriger si non connect√©
            useEffect(() => {
                if (!loading && !user && activeView !== 'login') {
                    // Ne pas rediriger, juste afficher l'√©cran de connexion
                }
            }, [user, loading, activeView]);
            
            // Gestion du changement de mot de passe
            const handlePasswordChange = async (e) => {
                e.preventDefault();
                setPasswordError('');
                
                if (passwordForm.newPassword !== passwordForm.confirmPassword) {
                    setPasswordError('Les mots de passe ne correspondent pas');
                    return;
                }
                
                if (passwordForm.newPassword.length < 6) {
                    setPasswordError('Le mot de passe doit contenir au moins 6 caract√®res');
                    return;
                }
                
                try {
                    // R√©authentifier l'utilisateur
                    await reauthenticate(passwordForm.currentPassword);
                    // Changer le mot de passe
                    await updatePassword(passwordForm.newPassword);
                    
                    toast.success('Mot de passe modifi√© avec succ√®s');
                    
                    setShowPasswordChange(false);
                    setPasswordForm({
                        currentPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    });
                } catch (error) {
                    let errorMessage = 'Erreur lors du changement de mot de passe';
                    if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Mot de passe actuel incorrect';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Le nouveau mot de passe est trop faible';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }
                    setPasswordError(errorMessage);
                }
            };

            // Afficher l'√©cran de connexion si non connect√©
            if (loading) {
                return (
                    <div className="loading">
                        <div>Chargement...</div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="auth-container">
                        <div className="auth-card">
                            <div className="auth-title">TrailPro</div>
                            <div className="auth-subtitle">
                                {isSignUp ? 'Cr√©ez votre compte' : 'Connectez-vous √† votre compte'}
                            </div>
                            
                            {authError && (
                                <div className="error-message">{authError}</div>
                            )}
                            
                            <form onSubmit={handleAuth}>
                                <div className="form-group">
                                    <label className="form-label">Email</label>
                                    <input
                                        className="form-input"
                                        type="email"
                                        value={authEmail}
                                        onChange={(e) => setAuthEmail(e.target.value)}
                                        placeholder="votre@email.com"
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Mot de passe</label>
                                    <input
                                        className="form-input"
                                        type="password"
                                        value={authPassword}
                                        onChange={(e) => setAuthPassword(e.target.value)}
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        required
                                        minLength="6"
                                    />
                                </div>
                                
                                <button 
                                    type="submit" 
                                    className="btn btn-primary btn-full"
                                    disabled={authLoading}
                                >
                                    {authLoading ? 'Chargement...' : (isSignUp ? 'Cr√©er mon compte' : 'Se connecter')}
                                </button>
                            </form>
                            
                            <div className="auth-toggle">
                                {isSignUp ? (
                                    <>D√©j√† un compte ? <button onClick={() => setIsSignUp(false)}>Se connecter</button></>
                                ) : (
                                    <>Pas encore de compte ? <button onClick={() => setIsSignUp(true)}>S'inscrire</button></>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            const calculateCurrentLevel = () => {
                // Calcul VMA bas√© sur le profil
                let estimatedVMA = 12; // d√©faut
                
                if (profile.vma && parseFloat(profile.vma) > 0) {
                    estimatedVMA = parseFloat(profile.vma);
                } else if (profile.best5k && parseFloat(profile.best5k) > 0) {
                    // Estimer VMA depuis temps au 5K (formule approximative)
                    const time5kMinutes = parseFloat(profile.best5k);
                    const speed5k = 5 / (time5kMinutes / 60); // km/h
                    estimatedVMA = speed5k * 1.08; // VMA ~ 108% de vitesse 5K
                } else if (profile.best10k && parseFloat(profile.best10k) > 0) {
                    // Estimer VMA depuis temps au 10K
                    const time10kMinutes = parseFloat(profile.best10k);
                    const speed10k = 10 / (time10kMinutes / 60); // km/h
                    estimatedVMA = speed10k * 1.10; // VMA ~ 110% de vitesse 10K
                } else {
                    // Bas√© sur niveau d√©clar√©
                    const vmaByLevel = {
                        beginner: 11,
                        intermediate: 13,
                        advanced: 15,
                        expert: 17
                    };
                    estimatedVMA = vmaByLevel[profile.level] || 12;
                }

                // Ajuster selon l'historique
                if (history.length > 0) {
                    const recent = history.slice(0, 5);
                    const totalSpeed = recent.reduce((acc, w) => acc + (w.distance / (w.time / 60)), 0);
                    const avgSpeed = totalSpeed / recent.length;

                    const avgDifficulty = recent.reduce((acc, w) => acc + (w.difficulty || 3), 0) / recent.length;
                    const difficultyFactor = avgDifficulty <= 2 ? 0.95 : (avgDifficulty >= 4 ? 1.05 : 1.0);

                    // Moyenne entre VMA estim√©e et performances r√©elles
                    const performanceVMA = avgSpeed * 1.1;
                    estimatedVMA = (estimatedVMA + performanceVMA) / 2 * difficultyFactor;
                }

                // Mode challenge : augmenter l√©g√®rement les attentes
                if (profile.challengeMode) {
                    estimatedVMA *= 1.05;
                }

                return {
                    avgSpeed: estimatedVMA * 0.75, // vitesse endurance ~ 75% VMA
                    vma: estimatedVMA,
                    avgElevationRate: 100
                };
            };

            // Calcul TRIMP (Training Impulse) - charge d'entra√Ænement
            const calculateTRIMP = (duration, intensityPercent) => {
                // intensityPercent: pourcentage de FC max (ex: 75 pour 75%)
                // Formule simplifi√©e: dur√©e √ó facteur de zone
                let zoneFactor = 1;
                if (intensityPercent < 60) zoneFactor = 1;
                else if (intensityPercent < 70) zoneFactor = 2;
                else if (intensityPercent < 80) zoneFactor = 3;
                else if (intensityPercent < 90) zoneFactor = 4;
                else zoneFactor = 5;

                return duration * zoneFactor;
            };

            // Calcul inclinaison tapis pour simuler d√©nivel√©
            const calculateTreadmillIncline = (elevation, distance) => {
                if (distance === 0) return { min: 0, max: 0, avg: 0 };
                
                // Pente moyenne en %
                const avgGrade = (elevation / (distance * 1000)) * 100;
                
                // Pour course en salle, on peut varier l'inclinaison
                // Suggestion de plage: ¬±20% de la moyenne
                const minIncline = Math.max(0, avgGrade * 0.8);
                const maxIncline = avgGrade * 1.2;
                
                // Arrondir √† l'entier le plus proche (1.3 -> 1, 1.6 -> 2)
                return {
                    min: Math.round(minIncline),
                    max: Math.round(maxIncline),
                    avg: Math.round(avgGrade)
                };
            };

            const generateWeeklyPlan = () => {
                if (!goal) return;

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const goalDate = new Date(goal.date);
                const weeksUntilGoal = Math.max(1, Math.ceil((goalDate - today) / (7 * 24 * 60 * 60 * 1000)));

                const currentLevel = calculateCurrentLevel();
                const targetDistance = parseFloat(goal.distance);
                const targetElevation = parseFloat(goal.elevation);
                const sessionsPerWeek = parseInt(goal.sessionsPerWeek) || 3;
                const maxDuration = parseInt(goal.maxDuration) || 60;
                const trainingType = goal.trainingType || 'mixed';

                // Facteur de volume d'entra√Ænement
                const volumeFactors = {
                    light: 0.85,
                    medium: 1.0,
                    high: 1.15
                };
                const volumeFactor = volumeFactors[profile.volume] || 1.0;

                // TRIMP cible par semaine (bas√© sur niveau et volume)
                const baseWeeklyTRIMP = {
                    beginner: 200,
                    intermediate: 300,
                    advanced: 400,
                    expert: 500
                };
                const targetWeeklyTRIMP = baseWeeklyTRIMP[profile.level] * volumeFactor;

                const weeks = [];

                for (let weekNum = 1; weekNum <= weeksUntilGoal; weekNum++) {
                    const weekProgress = weekNum / weeksUntilGoal;
                    const isLastWeek = weekNum === weeksUntilGoal;

                    const weekDistanceTarget = targetDistance * (0.4 + 0.6 * weekProgress) * volumeFactor;
                    const weekElevationTarget = targetElevation * (0.3 + 0.7 * weekProgress);

                    const workouts = [];
                    const weekStartDate = new Date(today);
                    weekStartDate.setDate(today.getDate() + (weekNum - 1) * 7);

                    if (isLastWeek) {
                        if (sessionsPerWeek >= 2) {
                            workouts.push({
                                id: `w${weekNum}-1`,
                                name: "Sortie l√©g√®re",
                                type: "recovery",
                                distance: targetDistance * 0.25,
                                elevation: targetElevation * 0.15,
                                estimatedTime: Math.round((targetDistance * 0.25 / currentLevel.avgSpeed) * 60),
                                description: "R√©cup√©ration active, 65-70% FC max",
                                fcPercent: 67,
                                includeFlat: true
                            });
                        }
                        
                        workouts.push({
                            id: `w${weekNum}-goal`,
                            name: goal.name || "Objectif",
                            type: "goal",
                            distance: targetDistance,
                            elevation: targetElevation,
                            estimatedTime: Math.round((targetDistance / currentLevel.avgSpeed) * 60 * 1.1),
                            description: "üéØ JOUR J - " + (goal.notes || "Bonne chance !"),
                            isGoal: true,
                            fcPercent: 85
                        });
                    } else {
                        let sessionTypes = [];
                        
                        if (trainingType === 'route') {
                            sessionTypes = sessionsPerWeek === 3 
                                ? ['endurance', 'interval-short', 'long']
                                : sessionsPerWeek === 4
                                ? ['endurance', 'interval-short', 'tempo', 'long']
                                : ['interval-short', 'long'];
                        } else if (trainingType === 'mountain') {
                            sessionTypes = sessionsPerWeek === 3
                                ? ['endurance', 'hills', 'long']
                                : sessionsPerWeek === 4
                                ? ['endurance', 'hills', 'interval-medium', 'long']
                                : ['hills', 'long'];
                        } else {
                            const useInterval = weekNum % 2 === 1;
                            sessionTypes = sessionsPerWeek === 3
                                ? ['endurance', useInterval ? 'interval-medium' : 'hills', 'long']
                                : sessionsPerWeek === 4
                                ? ['endurance', 'interval-medium', 'hills', 'long']
                                : [useInterval ? 'interval-medium' : 'hills', 'long'];
                        }

                        sessionTypes.forEach((type, index) => {
                            let workout = null;
                            
                            // Ajout de s√©ances sur plat (1 s√©ance sur 3 sans d√©nivel√©)
                            const includeFlat = (index === 0 && weekNum % 3 === 0) || type === 'interval-short';
                            
                            switch(type) {
                                case 'endurance':
                                    const enduranceDist = Math.max(
                                        Math.min(weekDistanceTarget * 0.25, maxDuration / 60 * currentLevel.avgSpeed),
                                        (20 / 60) * currentLevel.avgSpeed
                                    );
                                    workout = {
                                        name: "Endurance",
                                        type: "endurance",
                                        distance: Math.round(enduranceDist * 10) / 10,
                                        elevation: includeFlat ? 0 : Math.round(weekElevationTarget * 0.2),
                                        estimatedTime: Math.max(20, Math.round((enduranceDist / currentLevel.avgSpeed) * 60)),
                                        description: "Allure confortable, 70-75% FC max",
                                        fcPercent: 72,
                                        includeFlat: includeFlat
                                    };
                                    break;
                                
                                case 'interval-short':
                                    const intervalShortDist = Math.max(
                                        Math.min(weekDistanceTarget * 0.2, maxDuration / 60 * currentLevel.avgSpeed * 0.9),
                                        (20 / 60) * currentLevel.avgSpeed * 0.9
                                    );
                                    const vmaSpeed = currentLevel.vma || 12;
                                    const intervals = profile.challengeMode ? '10-12 x 30/30' : '8-10 x 30/30';
                                    workout = {
                                        name: "Fractionn√© court",
                                        type: "interval-short",
                                        distance: Math.round(intervalShortDist * 10) / 10,
                                        elevation: 0, // Fractionn√©s courts toujours sur plat
                                        estimatedTime: Math.max(20, Math.round((intervalShortDist / currentLevel.avgSpeed) * 60 * 0.9)),
                                        description: `VMA: ${intervals} √† ${vmaSpeed.toFixed(1)} km/h, 90-95% FC max`,
                                        fcPercent: 92,
                                        includeFlat: true
                                    };
                                    break;
                                
                                case 'interval-medium':
                                    const intervalMedDist = Math.max(
                                        Math.min(weekDistanceTarget * 0.25, maxDuration / 60 * currentLevel.avgSpeed * 0.95),
                                        (20 / 60) * currentLevel.avgSpeed * 0.95
                                    );
                                    const reps = profile.challengeMode ? '5-7 x 3min/2min' : '4-6 x 3min/2min';
                                    workout = {
                                        name: "Fractionn√© moyen",
                                        type: "interval-medium",
                                        distance: Math.round(intervalMedDist * 10) / 10,
                                        elevation: includeFlat ? 0 : Math.round(weekElevationTarget * 0.15),
                                        estimatedTime: Math.max(20, Math.round((intervalMedDist / currentLevel.avgSpeed) * 60 * 0.95)),
                                        description: `Tempo: ${reps}, 85-90% FC max`,
                                        fcPercent: 87,
                                        includeFlat: includeFlat
                                    };
                                    break;
                                
                                case 'tempo':
                                    const tempoDist = Math.max(
                                        Math.min(weekDistanceTarget * 0.3, maxDuration / 60 * currentLevel.avgSpeed * 1.05),
                                        (20 / 60) * currentLevel.avgSpeed * 1.05
                                    );
                                    workout = {
                                        name: "Tempo run",
                                        type: "tempo",
                                        distance: Math.round(tempoDist * 10) / 10,
                                        elevation: Math.round(weekElevationTarget * 0.2),
                                        estimatedTime: Math.max(20, Math.round((tempoDist / currentLevel.avgSpeed) * 60 * 0.95)),
                                        description: "Allure soutenue continue, 82-87% FC max",
                                        fcPercent: 84
                                    };
                                    break;
                                
                                case 'hills':
                                    const hillsDist = Math.max(
                                        Math.min(weekDistanceTarget * 0.22, maxDuration / 60 * currentLevel.avgSpeed * 0.85),
                                        (20 / 60) * currentLevel.avgSpeed * 0.85
                                    );
                                    const hillReps = profile.challengeMode ? '8-12 x c√¥tes' : '6-10 x c√¥tes';
                                    workout = {
                                        name: "C√¥tes",
                                        type: "hills",
                                        distance: Math.round(hillsDist * 10) / 10,
                                        elevation: Math.round(weekElevationTarget * 0.4),
                                        estimatedTime: Math.max(20, Math.round((hillsDist / currentLevel.avgSpeed) * 60 * 1.2)),
                                        description: `${hillReps}, 80-88% FC max`,
                                        fcPercent: 84
                                    };
                                    break;
                                
                                case 'long':
                                    const longDist = Math.max(
                                        Math.min(
                                            Math.min(weekDistanceTarget * 0.5, targetDistance * 0.8),
                                            maxDuration / 60 * currentLevel.avgSpeed * 1.1
                                        ),
                                        (25 / 60) * currentLevel.avgSpeed * 1.1 // min 25 min pour sortie longue
                                    );
                                    workout = {
                                        name: "Sortie longue",
                                        type: "long",
                                        distance: Math.round(longDist * 10) / 10,
                                        elevation: Math.round(weekElevationTarget * 0.45),
                                        estimatedTime: Math.max(25, Math.round((longDist / currentLevel.avgSpeed) * 60 * 1.05)),
                                        description: "Endurance fondamentale, 65-72% FC max",
                                        fcPercent: 68
                                    };
                                    break;
                            }
                            
                            if (workout) {
                                workout.id = `w${weekNum}-${index + 1}`;
                                // Calcul TRIMP pour cette s√©ance
                                workout.trimp = calculateTRIMP(workout.estimatedTime, workout.fcPercent || 75);
                                workouts.push(workout);
                            }
                        });
                    }

                    const weekTRIMP = workouts.reduce((acc, w) => acc + (w.trimp || 0), 0);

                    weeks.push({
                        weekNumber: weekNum,
                        startDate: weekStartDate.toISOString().split('T')[0],
                        workouts: workouts,
                        totalDistance: workouts.reduce((acc, w) => acc + w.distance, 0),
                        totalElevation: workouts.reduce((acc, w) => acc + w.elevation, 0),
                        weekTRIMP: weekTRIMP,
                        isCurrent: weekNum === 1
                    });
                }

                setWeeklyPlan(weeks);
            };

            const getCurrentWeek = () => {
                return weeklyPlan.find(w => w.isCurrent);
            };

            const getWorkoutStatus = (workout) => {
                return history.find(h => h.plannedWorkoutId === workout.id);
            };
            
            const getWorkoutDetails = (workout) => {
                const details = {
                    title: workout.name,
                    type: workout.type,
                    description: workout.description,
                    explanation: '',
                    treadmillIncline: null
                };
                
                // Calculer l'inclinaison tapis si n√©cessaire
                if (profile.indoorTraining && workout.elevation > 0 && workout.distance > 0) {
                    const incline = calculateTreadmillIncline(workout.elevation, workout.distance);
                    details.treadmillIncline = incline;
                }
                
                // Explications selon le type
                switch(workout.type) {
                    case 'endurance':
                        details.explanation = `L'endurance fondamentale est la base de l'entra√Ænement. C'est une allure confortable o√π vous pouvez tenir une conversation. Vous devez courir √† ${workout.fcPercent || 72}% de votre fr√©quence cardiaque maximale. Cette s√©ance am√©liore votre capacit√© a√©robie et votre √©conomie de course.`;
                        break;
                    case 'interval-short':
                        details.explanation = `Le fractionn√© court (VMA) consiste en des r√©p√©titions courtes et intenses suivies de r√©cup√©rations. Exemple : 30 secondes rapides √† ${calculateCurrentLevel().vma.toFixed(1)} km/h, puis 30 secondes de r√©cup√©ration active. R√©p√©tez 8-12 fois. Cette s√©ance am√©liore votre vitesse maximale a√©robie.`;
                        break;
                    case 'interval-medium':
                        details.explanation = `Le fractionn√© moyen (Tempo) combine vitesse et endurance. Exemple : 3 minutes √† allure soutenue (85-90% FC max), puis 2 minutes de r√©cup√©ration. R√©p√©tez 4-6 fois. Cette s√©ance am√©liore votre capacit√© √† maintenir une vitesse √©lev√©e.`;
                        break;
                    case 'tempo':
                        details.explanation = `Le tempo run est une course continue √† allure soutenue (82-87% FC max). C'est une allure "confortablement difficile" - vous pouvez la tenir 20-40 minutes. Cette s√©ance am√©liore votre seuil ana√©robie.`;
                        break;
                    case 'hills':
                        details.explanation = `L'entra√Ænement en c√¥tes renforce les muscles des jambes et am√©liore la puissance. Montez la c√¥te √† allure soutenue (80-88% FC max), puis redescendez en r√©cup√©ration active. R√©p√©tez 6-10 fois selon votre niveau.`;
                        break;
                    case 'long':
                        details.explanation = `La sortie longue d√©veloppe votre endurance. C'est une course √† allure confortable (65-72% FC max) sur une dur√©e plus longue. Cette s√©ance am√©liore votre capacit√© √† utiliser les graisses comme carburant.`;
                        break;
                    case 'recovery':
                        details.explanation = `La r√©cup√©ration active est une course tr√®s lente (65-70% FC max) qui favorise la r√©cup√©ration apr√®s un effort intense. C'est essentiel pour progresser sans se blesser.`;
                        break;
                    case 'goal':
                        details.explanation = `C'est le jour J ! Votre objectif de ${goal?.distance} km avec ${goal?.elevation} m de d√©nivel√©. Restez calme, respectez votre rythme et profitez de l'exp√©rience !`;
                        break;
                    default:
                        details.explanation = workout.description;
                }
                
                return details;
            };

            const handleGoalSubmit = async (e) => {
                e.preventDefault();
                try {
                    const goalToSave = { ...goalForm };
                    if (goal && goal.id) {
                        goalToSave.id = goal.id;
                    }
                    await saveGoal(user.uid, goalToSave);
                    setGoal(goalToSave);
                    toast.success(goal ? 'Objectif mis √† jour avec succ√®s' : 'Objectif cr√©√© avec succ√®s', { duration: 3000 });
                    setActiveView('home');
                } catch (error) {
                    console.error('Erreur lors de la sauvegarde de l\'objectif:', error);
                    toast.error('Erreur lors de la sauvegarde de l\'objectif');
                }
            };

            const startWorkout = (workout, isLocked) => {
                if (isLocked) return;
                setCurrentWorkout(workout);
                setShowModal(true);
            };

            const handleWorkoutSubmit = async (e) => {
                e.preventDefault();
                
                const newWorkout = {
                    plannedWorkoutId: currentWorkout.id,
                    name: currentWorkout.name,
                    type: currentWorkout.type,
                    distance: parseFloat(workoutForm.distance),
                    time: parseFloat(workoutForm.time),
                    elevation: parseFloat(workoutForm.elevation),
                    heartRate: parseFloat(workoutForm.heartRate),
                    difficulty: parseInt(workoutForm.difficulty),
                    notes: workoutForm.notes,
                    date: new Date().toISOString().split('T')[0],
                    speed: (parseFloat(workoutForm.distance) / (parseFloat(workoutForm.time) / 60)).toFixed(2),
                    pace: (parseFloat(workoutForm.time) / parseFloat(workoutForm.distance)).toFixed(1)
                };

                // Sauvegarder dans Firestore
                try {
                    await saveWorkout(user.uid, newWorkout);
                    setHistory([{ id: Date.now(), ...newWorkout }, ...history]);
                    toast.success('S√©ance valid√©e ! Le planning a √©t√© ajust√© selon vos performances.', { duration: 4000 });

                    if (goal) {
                        setTimeout(() => {
                            generateWeeklyPlan();
                        }, 100);
                    }
                } catch (error) {
                    console.error('Erreur lors de la sauvegarde:', error);
                    toast.error('Erreur lors de la sauvegarde de la s√©ance');
                }

                setWorkoutForm({
                    distance: '',
                    time: '',
                    elevation: '',
                    heartRate: '',
                    difficulty: 3,
                    notes: ''
                });
                setCurrentWorkout(null);
                setShowModal(false);
            };

            const calculateProgress = () => {
                if (!goal || history.length === 0) return null;

                const targetDistance = parseFloat(goal.distance);
                const targetElevation = parseFloat(goal.elevation);

                const bestDistance = Math.max(...history.map(w => w.distance));
                const bestElevation = Math.max(...history.map(w => w.elevation));

                const distanceProgress = Math.min(100, (bestDistance / targetDistance) * 100);
                const elevationProgress = Math.min(100, (bestElevation / targetElevation) * 100);

                const fourWeeksAgo = new Date();
                fourWeeksAgo.setDate(fourWeeksAgo.getDate() - 28);
                const recentWorkouts = history.filter(w => new Date(w.date) >= fourWeeksAgo);
                const targetSessions = parseInt(goal.sessionsPerWeek) * 4;
                const consistency = Math.min(100, (recentWorkouts.length / targetSessions) * 100);

                return {
                    distanceProgress,
                    elevationProgress,
                    consistency,
                    bestDistance,
                    bestElevation,
                    recentWorkouts: recentWorkouts.length
                };
            };

            const generateCalendar = () => {
                const days = [];
                const today = new Date();
                
                for (let i = 27; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const hasWorkout = history.some(w => w.date === dateStr);
                    const isToday = i === 0;
                    
                    days.push({
                        date: dateStr,
                        day: date.getDate(),
                        hasWorkout,
                        isToday
                    });
                }
                
                return days;
            };

            const currentWeek = getCurrentWeek();
            const progress = calculateProgress();
            const calendar = generateCalendar();

            const daysUntilGoal = goal ? Math.ceil((new Date(goal.date) - new Date()) / (24 * 60 * 60 * 1000)) : 0;

            return (
                <div className="app-container">
                    <div className="header">
                        <div className="header-left">
                            <div className="logo">TrailPro</div>
                        </div>
                        <div className="header-nav">
                            <button 
                                className={`nav-btn ${activeView === 'home' ? 'active' : ''}`}
                                onClick={() => setActiveView('home')}
                            >
                                Accueil
                            </button>
                            <button 
                                className={`nav-btn ${activeView === 'planning' ? 'active' : ''}`}
                                onClick={() => setActiveView('planning')}
                            >
                                Planning
                            </button>
                            <button 
                                className={`nav-btn ${activeView === 'progression' ? 'active' : ''}`}
                                onClick={() => setActiveView('progression')}
                            >
                                Progression
                            </button>
                            <button 
                                className={`nav-btn ${activeView === 'historique' ? 'active' : ''}`}
                                onClick={() => setActiveView('historique')}
                            >
                                Historique
                            </button>
                            <button 
                                className={`nav-btn ${activeView === 'profile' ? 'active' : ''}`}
                                onClick={() => setActiveView('profile')}
                            >
                                Profil
                            </button>
                            {/* Menu burger pour mobile */}
                            <div className="mobile-menu">
                                <button 
                                    className="burger-btn"
                                    onClick={() => setShowMobileMenu(!showMobileMenu)}
                                    aria-label="Menu"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2" style={{width: '24px', height: '24px'}}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                                    </svg>
                                </button>
                                {showMobileMenu && (
                                    <div className="mobile-dropdown">
                                        <button onClick={() => {setActiveView('home'); setShowMobileMenu(false);}} className={activeView === 'home' ? 'active' : ''}>Accueil</button>
                                        <button onClick={() => {setActiveView('planning'); setShowMobileMenu(false);}} className={activeView === 'planning' ? 'active' : ''}>Planning</button>
                                        <button onClick={() => {setActiveView('progression'); setShowMobileMenu(false);}} className={activeView === 'progression' ? 'active' : ''}>Progression</button>
                                        <button onClick={() => {setActiveView('historique'); setShowMobileMenu(false);}} className={activeView === 'historique' ? 'active' : ''}>Historique</button>
                                        <button onClick={() => {setActiveView('profile'); setShowMobileMenu(false);}} className={activeView === 'profile' ? 'active' : ''}>Profil</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="content">
                        {activeView === 'home' && (
                            <div>
                                {!goal ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üéØ</div>
                                        <div className="empty-title">Bienvenue sur TrailPro</div>
                                        <div className="empty-description">
                                            D√©finissez votre objectif pour recevoir un programme d'entra√Ænement personnalis√©
                                        </div>
                                        <button className="btn btn-primary" onClick={() => {
                                            setActiveView('profile');
                                            setActiveTab('goal');
                                        }}>
                                            Cr√©er mon objectif
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        <div className="goal-banner">
                                            <div className="goal-name">{goal.name}</div>
                                            <div className="goal-meta">
                                                <div className="goal-stat">
                                                    <span>üìÖ</span>
                                                    <span>{new Date(goal.date).toLocaleDateString('fr-FR', {day: 'numeric', month: 'long', year: 'numeric'})}</span>
                                                </div>
                                                <div className="goal-stat">
                                                    <span>üèÉ</span>
                                                    <span>{goal.distance} km</span>
                                                </div>
                                                <div className="goal-stat">
                                                    <span>‚õ∞Ô∏è</span>
                                                    <span>{goal.elevation} m D+</span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Message de bienvenue */}
                                        {user && (
                                            <div className="welcome-message">
                                                Salut <strong>{user.email?.split('@')[0] || 'Coureur'}</strong>, on court aujourd'hui ? üèÉ‚Äç‚ôÇÔ∏è
                                            </div>
                                        )}

                                        {currentWeek && (
                                            <div className="card">
                                                <div className="card-header">
                                                    <div className="card-title">Semaine en cours</div>
                                                    <div className="card-description">
                                                        {(() => {
                                                            const weekStart = new Date(currentWeek.startDate);
                                                            const weekEnd = new Date(weekStart);
                                                            weekEnd.setDate(weekStart.getDate() + 6);
                                                            return `${weekStart.toLocaleDateString('fr-FR', {day: 'numeric', month: 'short'})} - ${weekEnd.toLocaleDateString('fr-FR', {day: 'numeric', month: 'short', year: 'numeric'})}`;
                                                        })()}
                                                    </div>
                                                </div>

                                                <div className="workout-grid">
                                                    {currentWeek.workouts.map(workout => {
                                                        const completed = getWorkoutStatus(workout);
                                                        return (
                                                            <div 
                                                                key={workout.id} 
                                                                className={`workout-card ${completed ? 'completed' : ''}`}
                                                                onClick={() => !completed && startWorkout(workout, false)}
                                                                style={{cursor: completed ? 'default' : 'pointer'}}
                                                            >
                                                                <span className={`workout-badge ${workout.type}`}>
                                                                    {workout.type === 'endurance' && 'üèÉ Endurance'}
                                                                    {workout.type === 'interval-short' && '‚ö° VMA'}
                                                                    {workout.type === 'interval-medium' && '‚ö° Tempo'}
                                                                    {workout.type === 'tempo' && 'üî• Tempo'}
                                                                    {workout.type === 'hills' && '‚õ∞Ô∏è C√¥tes'}
                                                                    {workout.type === 'long' && 'üèÉ‚Äç‚ôÇÔ∏è Longue'}
                                                                    {workout.type === 'recovery' && 'üíÜ R√©cup'}
                                                                    {workout.type === 'goal' && 'üéØ Objectif'}
                                                                </span>
                                                                
                                                                <div className={`completed-check ${completed ? 'done' : 'pending'}`}>
                                                                    {completed ? '‚úì' : '‚óã'}
                                                                </div>

                                                                <div className="workout-name">{workout.name}</div>
                                                                <div className="workout-desc">{workout.description}</div>

                                                                <div className="workout-stats">
                                                                    <div className="workout-stat-item">
                                                                        <div className="workout-stat-label">Temps</div>
                                                                        <div className="workout-stat-value">
                                                                            {workout.estimatedTime}
                                                                            <span className="workout-stat-unit">min</span>
                                                                        </div>
                                                                    </div>
                                                                    <div className="workout-stat-item">
                                                                        <div className="workout-stat-label">D√©nivel√©</div>
                                                                        <div className="workout-stat-value">
                                                                            {workout.elevation}
                                                                            <span className="workout-stat-unit">m</span>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div className="workout-buttons-group">
                                                                    <button 
                                                                        className="btn btn-secondary"
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            setShowWorkoutDetails(workout);
                                                                        }}
                                                                    >
                                                                        ‚ÑπÔ∏è D√©tails
                                                                    </button>
                                                                    {!completed && (
                                                                        <button 
                                                                            className="btn btn-primary"
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                startWorkout(workout, false);
                                                                            }}
                                                                        >
                                                                            Valider
                                                                        </button>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}

                        {activeView === 'profile' && (
                            <div>
                                {/* Tabs */}
                                <div className="tabs">
                                    <button
                                        className={`tab-btn ${activeTab === 'profile' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('profile')}
                                    >
                                        Profil
                                    </button>
                                    <button
                                        className={`tab-btn ${activeTab === 'goal' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('goal')}
                                    >
                                        Objectif
                                    </button>
                                    <button
                                        className={`tab-btn ${activeTab === 'account' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('account')}
                                    >
                                        Compte
                                    </button>
                                </div>

                                {/* Tab: Profil */}
                                {activeTab === 'profile' && (
                                    <>
                                    <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">Votre profil</div>
                                        <div className="card-description">
                                            Renseignez vos infos pour un programme mieux calibr√©
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Volume d'entra√Ænement</label>
                                        <div className="radio-group">
                                            <label className={`radio-option ${profile.volume === 'light' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="volume"
                                                    value="light"
                                                    checked={profile.volume === 'light'}
                                                    onChange={(e) => setProfile({...profile, volume: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üåô L√©ger</div>
                                                    <div className="radio-option-desc">Volume r√©duit de 15% - Id√©al si vous d√©butez ou pratiquez d'autres sports</div>
                                                </div>
                                            </label>

                                            <label className={`radio-option ${profile.volume === 'medium' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="volume"
                                                    value="medium"
                                                    checked={profile.volume === 'medium'}
                                                    onChange={(e) => setProfile({...profile, volume: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">‚öñÔ∏è Moyen</div>
                                                    <div className="radio-option-desc">Volume standard - √âquilibre optimal</div>
                                                </div>
                                            </label>

                                            <label className={`radio-option ${profile.volume === 'high' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="volume"
                                                    value="high"
                                                    checked={profile.volume === 'high'}
                                                    onChange={(e) => setProfile({...profile, volume: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üí™ √âlev√©</div>
                                                    <div className="radio-option-desc">Volume augment√© de 15% - Pour coureurs exp√©riment√©s</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label style={{display: 'flex', alignItems: 'center', gap: '12px', cursor: 'pointer'}}>
                                            <input
                                                type="checkbox"
                                                checked={profile.indoorTraining}
                                                onChange={(e) => setProfile({...profile, indoorTraining: e.target.checked})}
                                                style={{width: '18px', height: '18px', cursor: 'pointer', accentColor: 'var(--orange-primary)'}}
                                            />
                                            <div>
                                                <div className="form-label" style={{marginBottom: '4px'}}>
                                                    üèÉ‚Äç‚ôÄÔ∏è Je cours en salle (tapis de course)
                                                </div>
                                                <div style={{fontSize: '13px', color: 'var(--gray-600)'}}>
                                                    Affiche les recommandations d'inclinaison pour simuler le d√©nivel√©
                                                </div>
                                            </div>
                                        </label>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Niveau de course</label>
                                        <div className="radio-group">
                                            <label className={`radio-option ${profile.level === 'beginner' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="level"
                                                    value="beginner"
                                                    checked={profile.level === 'beginner'}
                                                    onChange={(e) => setProfile({...profile, level: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üå± D√©butant</div>
                                                    <div className="radio-option-desc">Je d√©bute la course √† pied, VMA ~11 km/h</div>
                                                </div>
                                            </label>

                                            <label className={`radio-option ${profile.level === 'intermediate' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="level"
                                                    value="intermediate"
                                                    checked={profile.level === 'intermediate'}
                                                    onChange={(e) => setProfile({...profile, level: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üèÉ Interm√©diaire</div>
                                                    <div className="radio-option-desc">Je cours r√©guli√®rement depuis quelques mois, VMA ~13 km/h</div>
                                                </div>
                                            </label>

                                            <label className={`radio-option ${profile.level === 'advanced' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="level"
                                                    value="advanced"
                                                    checked={profile.level === 'advanced'}
                                                    onChange={(e) => setProfile({...profile, level: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üí™ Avanc√©</div>
                                                    <div className="radio-option-desc">Je cours depuis plusieurs ann√©es, VMA ~15 km/h</div>
                                                </div>
                                            </label>

                                            <label className={`radio-option ${profile.level === 'expert' ? 'selected' : ''}`}>
                                                <input
                                                    type="radio"
                                                    name="level"
                                                    value="expert"
                                                    checked={profile.level === 'expert'}
                                                    onChange={(e) => setProfile({...profile, level: e.target.value})}
                                                />
                                                <div className="radio-option-content">
                                                    <div className="radio-option-title">üî• Expert</div>
                                                    <div className="radio-option-desc">Coureur confirm√©, comp√©titions r√©guli√®res, VMA ~17 km/h</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Statistiques personnelles (optionnel)</label>
                                        <div className="form-row">
                                            <div className="form-group">
                                                <label className="form-label" style={{fontSize: '12px', color: 'var(--gray-600)'}}>
                                                    Meilleur 5K (minutes)
                                                </label>
                                                <input
                                                    className="form-input"
                                                    type="number"
                                                    step="0.1"
                                                    value={profile.best5k}
                                                    onChange={(e) => setProfile({...profile, best5k: e.target.value})}
                                                    placeholder="25.5"
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label" style={{fontSize: '12px', color: 'var(--gray-600)'}}>
                                                    Meilleur 10K (minutes)
                                                </label>
                                                <input
                                                    className="form-input"
                                                    type="number"
                                                    step="0.1"
                                                    value={profile.best10k}
                                                    onChange={(e) => setProfile({...profile, best10k: e.target.value})}
                                                    placeholder="52.0"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">VMA (km/h) - optionnel</label>
                                        <input
                                            className="form-input"
                                            type="number"
                                            step="0.1"
                                            value={profile.vma}
                                            onChange={(e) => setProfile({...profile, vma: e.target.value})}
                                            placeholder="Si vous connaissez votre VMA exacte"
                                        />
                                        <div style={{fontSize: '12px', color: 'var(--gray-600)', marginTop: '6px'}}>
                                            Si renseign√©, utilis√© pour calibrer les entra√Ænements
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label style={{display: 'flex', alignItems: 'center', gap: '12px', cursor: 'pointer'}}>
                                            <input
                                                type="checkbox"
                                                checked={profile.challengeMode}
                                                onChange={(e) => setProfile({...profile, challengeMode: e.target.checked})}
                                                style={{width: '18px', height: '18px', cursor: 'pointer', accentColor: 'var(--orange-primary)'}}
                                            />
                                            <div>
                                                <div className="form-label" style={{marginBottom: '4px'}}>
                                                    üî• Mode Challenge
                                                </div>
                                                <div style={{fontSize: '13px', color: 'var(--gray-600)'}}>
                                                    Entra√Ænements plus intenses avec r√©p√©titions suppl√©mentaires
                                                </div>
                                            </div>
                                        </label>
                                    </div>

                                    <button 
                                        className="btn btn-primary btn-full"
                                        onClick={async () => {
                                            try {
                                                // Sauvegarder le profil
                                                await saveProfile(user.uid, profile);
                                                
                                                // R√©g√©n√©rer le planning si un objectif existe
                                                if (goal) {
                                                    generateWeeklyPlan();
                                                    toast.success('Profil enregistr√© ! Les entra√Ænements ont √©t√© mis √† jour.');
                                                } else {
                                                    toast.success('Profil enregistr√© !');
                                                }
                                            } catch (error) {
                                                console.error('Erreur lors de la sauvegarde du profil:', error);
                                                toast.error('Erreur lors de la sauvegarde du profil');
                                            }
                                        }}
                                    >
                                        Enregistrer le profil
                                    </button>

                                    {(profile.best5k || profile.best10k || profile.vma) && (
                                        <div className="alert alert-info" style={{marginTop: '16px'}}>
                                            üí° Le programme utilise vos stats pour calculer votre VMA et adapter les s√©ances
                                        </div>
                                    )}
                                </div>

                                <div className="card">
                                    <div className="card-title">VMA estim√©e</div>
                                    <div style={{fontSize: '32px', fontWeight: '700', color: 'var(--orange-primary)', marginTop: '12px'}}>
                                        {calculateCurrentLevel().vma.toFixed(1)} <span style={{fontSize: '18px', color: 'var(--gray-600)'}}>km/h</span>
                                    </div>
                                    <div style={{fontSize: '13px', color: 'var(--gray-600)', marginTop: '8px'}}>
                                        Vitesse endurance: ~{(calculateCurrentLevel().vma * 0.75).toFixed(1)} km/h (75% VMA)
                                    </div>
                                    <div style={{fontSize: '13px', color: 'var(--gray-600)', marginTop: '4px'}}>
                                        Allure 10K: ~{(calculateCurrentLevel().vma * 0.85).toFixed(1)} km/h (85% VMA)
                                    </div>
                                </div>
                                </>
                                )}

                                {/* Tab: Objectif */}
                                {activeTab === 'goal' && (
                                    <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">
                                            {goal ? 'Modifier l\'objectif' : 'D√©finir votre objectif'}
                                        </div>
                                    </div>
                                    
                                    <form onSubmit={handleGoalSubmit}>
                                        <div className="form-group">
                                            <label className="form-label">Nom de l'objectif</label>
                                            <input
                                                className="form-input"
                                                type="text"
                                                value={goalForm.name}
                                                onChange={(e) => setGoalForm({...goalForm, name: e.target.value})}
                                                placeholder="Trail des Monts, Semi-marathon..."
                                                required
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">Date de l'objectif</label>
                                            <input
                                                className="form-input"
                                                type="date"
                                                value={goalForm.date}
                                                onChange={(e) => setGoalForm({...goalForm, date: e.target.value})}
                                                min={new Date().toISOString().split('T')[0]}
                                                required
                                            />
                                        </div>

                                        <div className="form-row">
                                            <div className="form-group">
                                                <label className="form-label">Distance (km)</label>
                                                <input
                                                    className="form-input"
                                                    type="number"
                                                    step="0.1"
                                                    value={goalForm.distance}
                                                    onChange={(e) => setGoalForm({...goalForm, distance: e.target.value})}
                                                    placeholder="15"
                                                    required
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">D√©nivel√© (m)</label>
                                                <input
                                                    className="form-input"
                                                    type="number"
                                                    value={goalForm.elevation}
                                                    onChange={(e) => setGoalForm({...goalForm, elevation: e.target.value})}
                                                    placeholder="500"
                                                    required
                                                />
                                            </div>
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">Notes (optionnel)</label>
                                            <textarea
                                                className="form-textarea"
                                                value={goalForm.notes}
                                                onChange={(e) => setGoalForm({...goalForm, notes: e.target.value})}
                                                placeholder="Infos, strat√©gie..."
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">Type de pr√©paration</label>
                                            <div className="radio-group">
                                                <label className={`radio-option ${goalForm.trainingType === 'route' ? 'selected' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="trainingType"
                                                        value="route"
                                                        checked={goalForm.trainingType === 'route'}
                                                        onChange={(e) => setGoalForm({...goalForm, trainingType: e.target.value})}
                                                    />
                                                    <div className="radio-option-content">
                                                        <div className="radio-option-title">üèÉ Route / Piste</div>
                                                        <div className="radio-option-desc">Focus VMA et fractionn√©s courts. Id√©al pour 5K, 10K, semi</div>
                                                    </div>
                                                </label>

                                                <label className={`radio-option ${goalForm.trainingType === 'mixed' ? 'selected' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="trainingType"
                                                        value="mixed"
                                                        checked={goalForm.trainingType === 'mixed'}
                                                        onChange={(e) => setGoalForm({...goalForm, trainingType: e.target.value})}
                                                    />
                                                    <div className="radio-option-content">
                                                        <div className="radio-option-title">üå≤ Trail l√©ger / Mixte</div>
                                                        <div className="radio-option-desc">√âquilibre fractionn√© et c√¥tes. Pour trails mod√©r√©s</div>
                                                    </div>
                                                </label>

                                                <label className={`radio-option ${goalForm.trainingType === 'mountain' ? 'selected' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="trainingType"
                                                        value="mountain"
                                                        checked={goalForm.trainingType === 'mountain'}
                                                        onChange={(e) => setGoalForm({...goalForm, trainingType: e.target.value})}
                                                    />
                                                    <div className="radio-option-content">
                                                        <div className="radio-option-title">‚õ∞Ô∏è Trail montagne</div>
                                                        <div className="radio-option-desc">Focus d√©nivel√©. Pour gros D+ et terrains techniques</div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                        <div className="form-row">
                                            <div className="form-group">
                                                <label className="form-label">S√©ances / semaine</label>
                                                <select
                                                    className="form-select"
                                                    value={goalForm.sessionsPerWeek}
                                                    onChange={(e) => setGoalForm({...goalForm, sessionsPerWeek: e.target.value})}
                                                >
                                                    <option value="2">2 s√©ances</option>
                                                    <option value="3">3 s√©ances</option>
                                                    <option value="4">4 s√©ances</option>
                                                </select>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">Dur√©e max</label>
                                                <select
                                                    className="form-select"
                                                    value={goalForm.maxDuration}
                                                    onChange={(e) => setGoalForm({...goalForm, maxDuration: e.target.value})}
                                                >
                                                    <option value="30">30 min</option>
                                                    <option value="45">45 min</option>
                                                    <option value="60">1h</option>
                                                    <option value="90">1h30</option>
                                                    <option value="120">2h</option>
                                                </select>
                                            </div>
                                        </div>

                                        <button type="submit" className="btn btn-primary btn-full">
                                            {goal ? 'Mettre √† jour' : 'Cr√©er le programme'}
                                        </button>

                                        {goal && (
                                            <button 
                                                type="button" 
                                                className="btn btn-secondary btn-full"
                                                onClick={async () => {
                                                    if (confirm('Supprimer cet objectif ?')) {
                                                        try {
                                                            if (goal && goal.id) {
                                                                await deleteGoal(user.uid, goal.id);
                                                            }
                                                            setGoal(null);
                                                            setWeeklyPlan([]);
                                                            toast.success('Objectif supprim√© avec succ√®s');
                                                            setActiveView('home');
                                                        } catch (error) {
                                                            console.error('Erreur lors de la suppression:', error);
                                                            toast.error('Erreur lors de la suppression de l\'objectif');
                                                        }
                                                    }
                                                }}
                                                style={{marginTop: '12px'}}
                                            >
                                                Supprimer l'objectif
                                            </button>
                                        )}
                                    </form>
                                </div>
                                )}

                                {/* Tab: Compte */}
                                {activeTab === 'account' && (
                                    <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">Param√®tres du compte</div>
                                        <div className="card-description">
                                            G√©rez vos informations de compte et votre s√©curit√©
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Email</label>
                                        <input
                                            className="form-input"
                                            type="email"
                                            value={user?.email || ''}
                                            disabled
                                            style={{background: 'var(--gray-50)', cursor: 'not-allowed'}}
                                        />
                                        <div style={{fontSize: '12px', color: 'var(--gray-600)', marginTop: '6px'}}>
                                            L'email ne peut pas √™tre modifi√©
                                        </div>
                                    </div>

                                    {user?.metadata?.creationTime && (
                                        <div className="form-group">
                                            <label className="form-label">Compte cr√©√© le</label>
                                            <div style={{padding: '10px 12px', background: 'var(--gray-50)', borderRadius: '8px', fontSize: '14px', color: 'var(--gray-700)'}}>
                                                {new Date(user.metadata.creationTime).toLocaleDateString('fr-FR', {
                                                    day: 'numeric',
                                                    month: 'long',
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                })}
                                            </div>
                                        </div>
                                    )}

                                    <div className="form-group" style={{marginBottom: 0}}>
                                        {!showPasswordChange ? (
                                            <button
                                                className="btn btn-secondary btn-full"
                                                onClick={() => setShowPasswordChange(true)}
                                            >
                                                Changer le mot de passe
                                            </button>
                                        ) : (
                                            <form onSubmit={handlePasswordChange}>
                                                {passwordError && (
                                                    <div className="error-message" style={{marginBottom: '16px'}}>
                                                        {passwordError}
                                                    </div>
                                                )}
                                                
                                                <div className="form-group">
                                                    <label className="form-label">Mot de passe actuel</label>
                                                    <input
                                                        className="form-input"
                                                        type="password"
                                                        value={passwordForm.currentPassword}
                                                        onChange={(e) => setPasswordForm({...passwordForm, currentPassword: e.target.value})}
                                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                        required
                                                    />
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Nouveau mot de passe</label>
                                                    <input
                                                        className="form-input"
                                                        type="password"
                                                        value={passwordForm.newPassword}
                                                        onChange={(e) => setPasswordForm({...passwordForm, newPassword: e.target.value})}
                                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                        required
                                                        minLength="6"
                                                    />
                                                    <div style={{fontSize: '12px', color: 'var(--gray-600)', marginTop: '6px'}}>
                                                        Minimum 6 caract√®res
                                                    </div>
                                                </div>

                                                <div className="form-group">
                                                    <label className="form-label">Confirmer le nouveau mot de passe</label>
                                                    <input
                                                        className="form-input"
                                                        type="password"
                                                        value={passwordForm.confirmPassword}
                                                        onChange={(e) => setPasswordForm({...passwordForm, confirmPassword: e.target.value})}
                                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                        required
                                                        minLength="6"
                                                    />
                                                </div>

                                                <div className="btn-group">
                                                    <button
                                                        type="button"
                                                        className="btn btn-secondary"
                                                        style={{flex: 1}}
                                                        onClick={() => {
                                                            setShowPasswordChange(false);
                                                            setPasswordForm({
                                                                currentPassword: '',
                                                                newPassword: '',
                                                                confirmPassword: ''
                                                            });
                                                            setPasswordError('');
                                                        }}
                                                    >
                                                        Annuler
                                                    </button>
                                                    <button
                                                        type="submit"
                                                        className="btn btn-primary"
                                                        style={{flex: 1}}
                                                    >
                                                        Modifier
                                                    </button>
                                                </div>
                                            </form>
                                        )}
                                    </div>

                                    <div className="form-group" style={{marginTop: '24px', paddingTop: '24px', borderTop: '1px solid var(--border)'}}>
                                        <button
                                            className="btn btn-secondary btn-full"
                                            onClick={async () => {
                                                await signOut();
                                                toast.info('Vous avez √©t√© d√©connect√©');
                                            }}
                                        >
                                            D√©connexion
                                        </button>
                                    </div>
                                </div>
                                )}
                            </div>
                        )}

                        {activeView === 'planning' && (
                            <div>
                                {!goal ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üéØ</div>
                                        <div className="empty-title">Pas d'objectif</div>
                                        <div className="empty-description">D√©finissez un objectif pour voir votre planning</div>
                                        <button className="btn btn-primary" onClick={() => {
                                            setActiveView('profile');
                                            setActiveTab('goal');
                                        }}>
                                            Cr√©er un objectif
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        <div className="alert alert-info">
                                            üìÖ Programme sur {weeklyPlan.length} semaines jusqu'au {new Date(goal.date).toLocaleDateString('fr-FR')}
                                        </div>

                                        {weeklyPlan.map(week => {
                                            const completedCount = week.workouts.filter(w => getWorkoutStatus(w)).length;
                                            return (
                                                <div key={week.weekNumber} className="card">
                                                    <div className="week-header">
                                                        <div className="week-title">
                                                            Semaine {week.weekNumber}
                                                        </div>
                                                        <span className={`week-badge ${week.isCurrent ? 'current' : 'future'}`}>
                                                            {week.isCurrent ? 'En cours' : '√Ä venir'}
                                                        </span>
                                                    </div>

                                                    <div className="week-summary">
                                                        <span>üìä {week.totalDistance.toFixed(1)} km</span>
                                                        <span>‚õ∞Ô∏è {week.totalElevation} m D+</span>
                                                        <span>‚úì {completedCount}/{week.workouts.length} s√©ances</span>
                                                    </div>

                                                    <div className="workout-grid">
                                                        {week.workouts.map(workout => {
                                                            const completed = getWorkoutStatus(workout);
                                                            const isLocked = !week.isCurrent;
                                                            return (
                                                                <div 
                                                                    key={workout.id} 
                                                                    className={`workout-card ${completed ? 'completed' : ''} ${isLocked ? 'locked' : ''}`}
                                                                    onClick={() => !completed && !isLocked && startWorkout(workout, isLocked)}
                                                                    style={{cursor: completed || isLocked ? 'default' : 'pointer'}}
                                                                >
                                                                    <span className={`workout-badge ${workout.type}`}>
                                                                        {workout.type === 'endurance' && 'üèÉ Endurance'}
                                                                        {workout.type === 'interval-short' && '‚ö° VMA'}
                                                                        {workout.type === 'interval-medium' && '‚ö° Tempo'}
                                                                        {workout.type === 'tempo' && 'üî• Tempo'}
                                                                        {workout.type === 'hills' && '‚õ∞Ô∏è C√¥tes'}
                                                                        {workout.type === 'long' && 'üèÉ‚Äç‚ôÇÔ∏è Longue'}
                                                                        {workout.type === 'recovery' && 'üíÜ R√©cup'}
                                                                        {workout.type === 'goal' && 'üéØ Objectif'}
                                                                    </span>
                                                                    
                                                                    <div className={`completed-check ${completed ? 'done' : 'pending'}`}>
                                                                        {completed ? '‚úì' : '‚óã'}
                                                                    </div>

                                                                    <div className="workout-name">{workout.name}</div>
                                                                    <div className="workout-desc">{workout.description}</div>

                                                                    <div className="workout-stats">
                                                                        <div className="workout-stat-item">
                                                                            <div className="workout-stat-label">Temps</div>
                                                                            <div className="workout-stat-value">
                                                                                {workout.estimatedTime}
                                                                                <span className="workout-stat-unit">min</span>
                                                                            </div>
                                                                        </div>
                                                                        <div className="workout-stat-item">
                                                                            <div className="workout-stat-label">D√©nivel√©</div>
                                                                            <div className="workout-stat-value">
                                                                                {workout.elevation}
                                                                                <span className="workout-stat-unit">m</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div className="workout-buttons-group">
                                                                        <button 
                                                                            className="btn btn-secondary"
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                setShowWorkoutDetails(workout);
                                                                            }}
                                                                        >
                                                                            ‚ÑπÔ∏è D√©tails
                                                                        </button>
                                                                        {!completed && !isLocked && (
                                                                            <button 
                                                                                className="btn btn-primary"
                                                                                onClick={(e) => {
                                                                                    e.stopPropagation();
                                                                                    startWorkout(workout, isLocked);
                                                                                }}
                                                                            >
                                                                                Valider
                                                                            </button>
                                                                        )}
                                                                    </div>

                                                                    {isLocked && (
                                                                        <div className="locked-overlay">
                                                                            üîí Semaine {week.weekNumber}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </>
                                )}
                            </div>
                        )}

                        {activeView === 'progression' && (
                            <div>
                                {!goal ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üìä</div>
                                        <div className="empty-title">Pas d'objectif</div>
                                        <div className="empty-description">D√©finissez un objectif pour suivre votre progression</div>
                                        <button className="btn btn-primary" onClick={() => {
                                            setActiveView('profile');
                                            setActiveTab('goal');
                                        }}>
                                            Cr√©er un objectif
                                        </button>
                                    </div>
                                ) : !progress ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üìä</div>
                                        <div className="empty-title">Pas encore de donn√©es</div>
                                        <div className="empty-description">Compl√©tez des s√©ances pour voir votre progression</div>
                                    </div>
                                ) : (
                                    <>
                                        <div className="card">
                                            <div className="progress-section">
                                                <div className="progress-header">
                                                    <span className="progress-label">Distance maximale</span>
                                                    <span className="progress-value">
                                                        {progress.distanceProgress.toFixed(0)}%
                                                    </span>
                                                </div>
                                                <div style={{fontSize: '13px', color: 'var(--gray-600)', marginBottom: '8px'}}>
                                                    {progress.bestDistance.toFixed(1)} km / {goal.distance} km
                                                </div>
                                                <div className="progress-bar">
                                                    <div className="progress-fill" style={{width: `${progress.distanceProgress}%`}}></div>
                                                </div>
                                            </div>

                                            <div className="progress-section">
                                                <div className="progress-header">
                                                    <span className="progress-label">D√©nivel√© maximal</span>
                                                    <span className="progress-value">
                                                        {progress.elevationProgress.toFixed(0)}%
                                                    </span>
                                                </div>
                                                <div style={{fontSize: '13px', color: 'var(--gray-600)', marginBottom: '8px'}}>
                                                    {progress.bestElevation} m / {goal.elevation} m
                                                </div>
                                                <div className="progress-bar">
                                                    <div className="progress-fill" style={{width: `${progress.elevationProgress}%`}}></div>
                                                </div>
                                            </div>

                                            <div className="progress-section" style={{marginBottom: 0}}>
                                                <div className="progress-header">
                                                    <span className="progress-label">Assiduit√© (4 semaines)</span>
                                                    <span className="progress-value" style={{color: progress.consistency >= 75 ? '#10B981' : '#F59E0B'}}>
                                                        {progress.consistency.toFixed(0)}%
                                                    </span>
                                                </div>
                                                <div style={{fontSize: '13px', color: 'var(--gray-600)', marginBottom: '8px'}}>
                                                    {progress.recentWorkouts} / {parseInt(goal.sessionsPerWeek) * 4} s√©ances
                                                </div>
                                                <div className="progress-bar">
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{
                                                            width: `${progress.consistency}%`,
                                                            background: progress.consistency >= 75 ? '#10B981' : '#F59E0B'
                                                        }}
                                                    ></div>
                                                </div>
                                            </div>
                                        </div>

                                        {progress.consistency < 50 && (
                                            <div className="alert alert-warning">
                                                ‚ö†Ô∏è Assiduit√© faible. Essayez de maintenir {goal.sessionsPerWeek} s√©ances/semaine
                                            </div>
                                        )}

                                        <div className="card">
                                            <div className="card-title">Calendrier (28 derniers jours)</div>
                                            <div className="calendar-grid">
                                                {calendar.map(day => (
                                                    <div 
                                                        key={day.date} 
                                                        className={`calendar-day ${day.hasWorkout ? 'has-workout' : ''} ${day.isToday ? 'today' : ''}`}
                                                    >
                                                        {day.day}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {activeView === 'historique' && (
                            <div>
                                {history.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üìù</div>
                                        <div className="empty-title">Aucune s√©ance</div>
                                        <div className="empty-description">Vos s√©ances compl√©t√©es appara√Ætront ici</div>
                                    </div>
                                ) : (
                                    <>
                                        <div className="stats-grid">
                                            <div className="stat-card">
                                                <div className="stat-title">Total s√©ances</div>
                                                <div className="stat-number">{history.length}</div>
                                            </div>
                                            <div className="stat-card">
                                                <div className="stat-title">Cette semaine</div>
                                                <div className="stat-number">
                                                    {history.filter(w => {
                                                        const weekAgo = new Date();
                                                        weekAgo.setDate(weekAgo.getDate() - 7);
                                                        return new Date(w.date) >= weekAgo;
                                                    }).length}
                                                </div>
                                            </div>
                                        </div>

                                        {history.map(workout => (
                                            <div key={workout.id} className="history-item">
                                                <div className="history-date">
                                                    {new Date(workout.date).toLocaleDateString('fr-FR', {
                                                        weekday: 'long',
                                                        year: 'numeric',
                                                        month: 'long',
                                                        day: 'numeric'
                                                    })}
                                                </div>
                                                <div className="history-name">{workout.name}</div>
                                                {workout.notes && (
                                                    <div className="history-note">"{workout.notes}"</div>
                                                )}
                                                <div className="history-stats">
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">Distance</div>
                                                        <div className="history-stat-value">{workout.distance} km</div>
                                                    </div>
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">Temps</div>
                                                        <div className="history-stat-value">{workout.time} min</div>
                                                    </div>
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">D+</div>
                                                        <div className="history-stat-value">{workout.elevation} m</div>
                                                    </div>
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">Allure</div>
                                                        <div className="history-stat-value">{workout.pace} min/km</div>
                                                    </div>
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">Vitesse</div>
                                                        <div className="history-stat-value">{workout.speed} km/h</div>
                                                    </div>
                                                    <div className="history-stat">
                                                        <div className="history-stat-label">FC moy</div>
                                                        <div className="history-stat-value">{workout.heartRate} bpm</div>
                                                    </div>
                                                </div>
                                                {workout.difficulty && (
                                                    <span className={`difficulty-badge difficulty-${workout.difficulty}`}>
                                                        {workout.difficulty === 1 && 'üò´ Tr√®s difficile'}
                                                        {workout.difficulty === 2 && 'üòì Difficile'}
                                                        {workout.difficulty === 3 && 'üòä Juste bien'}
                                                        {workout.difficulty === 4 && 'üôÇ Facile'}
                                                        {workout.difficulty === 5 && 'üòé Tr√®s facile'}
                                                    </span>
                                                )}
                                            </div>
                                        ))}
                                    </>
                                )}
                            </div>
                        )}
                    </div>

                    {showModal && currentWorkout && (
                        <div className="modal-overlay" onClick={() => setShowModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">Valider la s√©ance</div>
                                    <div className="modal-subtitle">{currentWorkout.name}</div>
                                </div>

                                <form onSubmit={handleWorkoutSubmit}>
                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">Distance (km)</label>
                                            <input
                                                className="form-input"
                                                type="number"
                                                step="0.01"
                                                value={workoutForm.distance}
                                                onChange={(e) => setWorkoutForm({...workoutForm, distance: e.target.value})}
                                                placeholder={currentWorkout.distance.toString()}
                                                required
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">Temps (min)</label>
                                            <input
                                                className="form-input"
                                                type="number"
                                                value={workoutForm.time}
                                                onChange={(e) => setWorkoutForm({...workoutForm, time: e.target.value})}
                                                placeholder={currentWorkout.estimatedTime.toString()}
                                                required
                                            />
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">D√©nivel√© (m)</label>
                                            <input
                                                className="form-input"
                                                type="number"
                                                value={workoutForm.elevation}
                                                onChange={(e) => setWorkoutForm({...workoutForm, elevation: e.target.value})}
                                                placeholder={currentWorkout.elevation.toString()}
                                                required
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">FC moy (bpm)</label>
                                            <input
                                                className="form-input"
                                                type="number"
                                                value={workoutForm.heartRate}
                                                onChange={(e) => setWorkoutForm({...workoutForm, heartRate: e.target.value})}
                                                placeholder="145"
                                                required
                                            />
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Difficult√© ressentie</label>
                                        <div className="difficulty-selector">
                                            {[
                                                { value: 1, emoji: 'üò´', label: 'Tr√®s dur' },
                                                { value: 2, emoji: 'üòì', label: 'Dur' },
                                                { value: 3, emoji: 'üòä', label: 'Bien' },
                                                { value: 4, emoji: 'üôÇ', label: 'Facile' },
                                                { value: 5, emoji: 'üòé', label: 'Tr√®s facile' }
                                            ].map(diff => (
                                                <button
                                                    key={diff.value}
                                                    type="button"
                                                    className={`difficulty-btn ${workoutForm.difficulty === diff.value ? 'selected' : ''}`}
                                                    onClick={() => setWorkoutForm({...workoutForm, difficulty: diff.value})}
                                                >
                                                    <span className="difficulty-emoji">{diff.emoji}</span>
                                                    <span className="difficulty-label">{diff.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Notes (optionnel)</label>
                                        <textarea
                                            className="form-textarea"
                                            value={workoutForm.notes}
                                            onChange={(e) => setWorkoutForm({...workoutForm, notes: e.target.value})}
                                            placeholder="Ressenti, m√©t√©o, parcours..."
                                        />
                                    </div>

                                    <div className="btn-group">
                                        <button 
                                            type="button" 
                                            className="btn btn-secondary"
                                            style={{flex: 1}}
                                            onClick={() => {
                                                setShowModal(false);
                                                setWorkoutForm({
                                                    distance: '',
                                                    time: '',
                                                    elevation: '',
                                                    heartRate: '',
                                                    difficulty: 3,
                                                    notes: ''
                                                });
                                            }}
                                        >
                                            Annuler
                                        </button>
                                        <button type="submit" className="btn btn-success" style={{flex: 1}}>
                                            ‚úì Valider
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal D√©tails de l'entra√Ænement */}
                    {showWorkoutDetails && (
                        <div className="modal-overlay" onClick={() => setShowWorkoutDetails(null)}>
                            <div className="modal workout-details-modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">{showWorkoutDetails.name}</div>
                                    <div className="modal-subtitle">{getWorkoutDetails(showWorkoutDetails).description}</div>
                                </div>

                                <div className="workout-details-section">
                                    <h4>üìñ Qu'est-ce que c'est ?</h4>
                                    <p>{getWorkoutDetails(showWorkoutDetails).explanation}</p>
                                </div>

                                <div className="workout-details-section">
                                    <h4>üìä Param√®tres de la s√©ance</h4>
                                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px'}}>
                                        <div>
                                            <div style={{fontSize: '12px', color: 'var(--gray-600)', marginBottom: '4px'}}>Temps estim√©</div>
                                            <div style={{fontSize: '18px', fontWeight: '600', color: 'var(--gray-900)'}}>
                                                {showWorkoutDetails.estimatedTime} min
                                            </div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: 'var(--gray-600)', marginBottom: '4px'}}>D√©nivel√©</div>
                                            <div style={{fontSize: '18px', fontWeight: '600', color: 'var(--gray-900)'}}>
                                                {showWorkoutDetails.elevation} m
                                            </div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: 'var(--gray-600)', marginBottom: '4px'}}>Fr√©quence cardiaque</div>
                                            <div style={{fontSize: '18px', fontWeight: '600', color: 'var(--gray-900)'}}>
                                                {showWorkoutDetails.fcPercent || 75}% FC max
                                            </div>
                                        </div>
                                        <div>
                                            <div style={{fontSize: '12px', color: 'var(--gray-600)', marginBottom: '4px'}}>Distance</div>
                                            <div style={{fontSize: '18px', fontWeight: '600', color: 'var(--gray-900)'}}>
                                                {showWorkoutDetails.distance} km
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {profile.indoorTraining && getWorkoutDetails(showWorkoutDetails).treadmillIncline && (
                                    <div className="workout-details-section">
                                        <h4>üèÉ‚Äç‚ôÄÔ∏è Param√®tres tapis de course</h4>
                                        <div className="treadmill-info">
                                            <p>
                                                <strong>Inclinaison recommand√©e :</strong> {getWorkoutDetails(showWorkoutDetails).treadmillIncline.avg}%<br/>
                                                <span style={{fontSize: '12px', color: 'var(--gray-600)'}}>
                                                    (Plage : {getWorkoutDetails(showWorkoutDetails).treadmillIncline.min}% - {getWorkoutDetails(showWorkoutDetails).treadmillIncline.max}%)
                                                </span>
                                            </p>
                                            <p style={{fontSize: '13px', marginTop: '8px', color: 'var(--gray-600)'}}>
                                                Variez l'inclinaison pendant votre s√©ance pour simuler le d√©nivel√© naturel du trail.
                                            </p>
                                        </div>
                                    </div>
                                )}

                                <button 
                                    className="btn btn-secondary btn-full"
                                    style={{marginTop: '24px'}}
                                    onClick={() => setShowWorkoutDetails(null)}
                                >
                                    Fermer
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TrailTrainingApp />);
    </script>
</body>
</html>
